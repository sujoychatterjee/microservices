!function(i,t){"use strict";"function"==typeof define&&define.amd?define("gridster-coords",["jquery"],t):i.GridsterCoords=t(i.$||i.jQuery)}(this,function(i){function t(t){return t[0]&&i.isPlainObject(t[0])?this.data=t[0]:this.el=t,this.isCoords=!0,this.coords={},this.init(),this}var s=t.prototype;return s.init=function(){this.set(),this.original_coords=this.get()},s.set=function(i,t){var s=this.el;if(s&&!i&&(this.data=s.offset(),this.data.width=s.width(),this.data.height=s.height()),s&&i&&!t){var e=s.offset();this.data.top=e.top,this.data.left=e.left}var r=this.data;return"undefined"==typeof r.left&&(r.left=r.x1),"undefined"==typeof r.top&&(r.top=r.y1),this.coords.x1=r.left,this.coords.y1=r.top,this.coords.x2=r.left+r.width,this.coords.y2=r.top+r.height,this.coords.cx=r.left+r.width/2,this.coords.cy=r.top+r.height/2,this.coords.width=r.width,this.coords.height=r.height,this.coords.el=s||!1,this},s.update=function(t){if(!t&&!this.el)return this;if(t){var s=i.extend({},this.data,t);return this.data=s,this.set(!0,!0)}return this.set(!0),this},s.get=function(){return this.coords},s.destroy=function(){this.el.removeData("coords"),delete this.el},i.fn.coords=function(){if(this.data("coords"))return this.data("coords");var i=new t(this,arguments[0]);return this.data("coords",i),i},t}),function(i,t){"function"==typeof define&&define.amd?define("gridster-collision",["jquery","gridster-coords"],t):i.GridsterCollision=t(i.$||i.jQuery,i.GridsterCoords)}(this,function(i,t){function s(t,s,r){this.options=i.extend(e,r),this.$element=t,this.last_colliders=[],this.last_colliders_coords=[],this.set_colliders(s),this.init()}var e={colliders_context:document.body,overlapping_region:"C"};s.defaults=e;var r=s.prototype;return r.init=function(){this.find_collisions()},r.overlaps=function(i,t){var s=!1,e=!1;return(t.x1>=i.x1&&t.x1<=i.x2||t.x2>=i.x1&&t.x2<=i.x2||i.x1>=t.x1&&i.x2<=t.x2)&&(s=!0),(t.y1>=i.y1&&t.y1<=i.y2||t.y2>=i.y1&&t.y2<=i.y2||i.y1>=t.y1&&i.y2<=t.y2)&&(e=!0),s&&e},r.detect_overlapping_region=function(i,t){var s="",e="";return i.y1>t.cy&&i.y1<t.y2&&(s="N"),i.y2>t.y1&&i.y2<t.cy&&(s="S"),i.x1>t.cx&&i.x1<t.x2&&(e="W"),i.x2>t.x1&&i.x2<t.cx&&(e="E"),s+e||"C"},r.calculate_overlapped_area_coords=function(t,s){var e=Math.max(t.x1,s.x1),r=Math.max(t.y1,s.y1),o=Math.min(t.x2,s.x2),a=Math.min(t.y2,s.y2);return i({left:e,top:r,width:o-e,height:a-r}).coords().get()},r.calculate_overlapped_area=function(i){return i.width*i.height},r.manage_colliders_start_stop=function(t,s,e){for(var r=this.last_colliders_coords,o=0,a=r.length;a>o;o++)-1===i.inArray(r[o],t)&&s.call(this,r[o]);for(var n=0,h=t.length;h>n;n++)-1===i.inArray(t[n],r)&&e.call(this,t[n])},r.find_collisions=function(t){for(var s=this,e=this.options.overlapping_region,r=[],o=[],a=this.colliders||this.$colliders,n=a.length,h=s.$element.coords().update(t||!1).get();n--;){var _=s.$colliders?i(a[n]):a[n],d=_.isCoords?_:_.coords(),l=d.get(),c=s.overlaps(h,l);if(c){var p=s.detect_overlapping_region(h,l);if(p===e||"all"===e){var g=s.calculate_overlapped_area_coords(h,l),u=s.calculate_overlapped_area(g),f={area:u,area_coords:g,region:p,coords:l,player_coords:h,el:_};s.options.on_overlap&&s.options.on_overlap.call(this,f),r.push(d),o.push(f)}}}return(s.options.on_overlap_stop||s.options.on_overlap_start)&&this.manage_colliders_start_stop(r,s.options.on_overlap_start,s.options.on_overlap_stop),this.last_colliders_coords=r,o},r.get_closest_colliders=function(i){var t=this.find_collisions(i);return t.sort(function(i,t){return"C"===i.region&&"C"===t.region?i.coords.y1<t.coords.y1||i.coords.x1<t.coords.x1?-1:1:(i.area<t.area,1)}),t},r.set_colliders=function(t){"string"==typeof t||t instanceof i?this.$colliders=i(t,this.options.colliders_context).not(this.$element):this.colliders=i(t)},i.fn.collision=function(i,t){return new s(this,i,t)},s}),function(i,t){i.delay=function(i,t){var s=Array.prototype.slice.call(arguments,2);return setTimeout(function(){return i.apply(null,s)},t)},i.debounce=function(i,t,s){var e;return function(){var r=this,o=arguments,a=function(){e=null,s||i.apply(r,o)};s&&!e&&i.apply(r,o),clearTimeout(e),e=setTimeout(a,t)}},i.throttle=function(i,t){var s,e,r,o,a,n,h=debounce(function(){a=o=!1},t);return function(){s=this,e=arguments;var _=function(){r=null,a&&i.apply(s,e),h()};return r||(r=setTimeout(_,t)),o?a=!0:n=i.apply(s,e),h(),o=!0,n}}}(window),function(i,t){"function"==typeof define&&define.amd?define("gridster-draggable",["jquery"],t):i.GridsterDraggable=t(i.$||i.jQuery)}(this,function(i){function t(t,e){this.options=i.extend({},s,e),this.$document=i(document),this.$container=i(t),this.$dragitems=i(this.options.items,this.$container),this.is_dragging=!1,this.player_min_left=0+this.options.offset_left,this.id=h(),this.ns=".gridster-draggable-"+this.id,this.init()}var s={items:"li",distance:1,limit:!0,offset_left:0,autoscroll:!0,ignore_dragging:["INPUT","TEXTAREA","SELECT","BUTTON"],handle:null,container_width:0,move_element:!0,helper:!1,remove_helper:!0},e=i(window),r={x:"left",y:"top"},o=!!("ontouchstart"in window),a=function(i){return i.charAt(0).toUpperCase()+i.slice(1)},n=0,h=function(){return++n+""};t.defaults=s;var _=t.prototype;return _.init=function(){var t=this.$container.css("position");this.calculate_dimensions(),this.$container.css("position","static"===t?"relative":t),this.disabled=!1,this.events(),i(window).bind(this.nsEvent("resize"),debounce(i.proxy(this.calculate_dimensions,this),200))},_.nsEvent=function(i){return(i||"")+this.ns},_.events=function(){this.pointer_events={start:this.nsEvent("touchstart")+" "+this.nsEvent("mousedown"),move:this.nsEvent("touchmove")+" "+this.nsEvent("mousemove"),end:this.nsEvent("touchend")+" "+this.nsEvent("mouseup")},this.$container.on(this.nsEvent("selectstart"),i.proxy(this.on_select_start,this)),this.$container.on(this.pointer_events.start,this.options.items,i.proxy(this.drag_handler,this)),this.$document.on(this.pointer_events.end,i.proxy(function(i){this.is_dragging=!1,this.disabled||(this.$document.off(this.pointer_events.move),this.drag_start&&this.on_dragstop(i))},this))},_.get_actual_pos=function(i){var t=i.position();return t},_.get_mouse_pos=function(i){if(i.originalEvent&&i.originalEvent.touches){var t=i.originalEvent;i=t.touches.length?t.touches[0]:t.changedTouches[0]}return{left:i.clientX,top:i.clientY}},_.get_offset=function(t){t.preventDefault();var s=this.get_mouse_pos(t),e=Math.round(s.left-this.mouse_init_pos.left),r=Math.round(s.top-this.mouse_init_pos.top),o=Math.round(this.el_init_offset.left+e-this.baseX+i(window).scrollLeft()-this.win_offset_x),a=Math.round(this.el_init_offset.top+r-this.baseY+i(window).scrollTop()-this.win_offset_y);return this.options.limit&&(o>this.player_max_left?o=this.player_max_left:o<this.player_min_left&&(o=this.player_min_left)),{position:{left:o,top:a},pointer:{left:s.left,top:s.top,diff_left:e+(i(window).scrollLeft()-this.win_offset_x),diff_top:r+(i(window).scrollTop()-this.win_offset_y)}}},_.get_drag_data=function(i){var t=this.get_offset(i);return t.$player=this.$player,t.$helper=this.helper?this.$helper:this.$player,t},_.set_limits=function(i){return i||(i=this.$container.width()),this.player_max_left=i-this.player_width+-this.options.offset_left,this.options.container_width=i,this},_.scroll_in=function(t,s){var o,n=r[t],h=50,_=30,d="x"===t,l=d?this.window_width:this.window_height,c=d?i(document).width():i(document).height(),p=d?this.$player.width():this.$player.height(),g=e["scroll"+a(n)](),u=g,f=u+l,w=f-h,m=u+h,y=u+s.pointer[n],v=c-l+p;return y>=w&&(o=g+_,v>o&&(e["scroll"+a(n)](o),this["scroll_offset_"+t]+=_)),m>=y&&(o=g-_,o>0&&(e["scroll"+a(n)](o),this["scroll_offset_"+t]-=_)),this},_.manage_scroll=function(i){this.scroll_in("x",i),this.scroll_in("y",i)},_.calculate_dimensions=function(i){this.window_height=e.height(),this.window_width=e.width()},_.drag_handler=function(t){t.target.nodeName;if(!this.disabled&&(1===t.which||o)&&!this.ignore_drag(t)){var s=this,e=!0;return this.$player=i(t.currentTarget),this.el_init_pos=this.get_actual_pos(this.$player),this.mouse_init_pos=this.get_mouse_pos(t),this.offsetY=this.mouse_init_pos.top-this.el_init_pos.top,this.$document.on(this.pointer_events.move,function(i){var t=s.get_mouse_pos(i),r=Math.abs(t.left-s.mouse_init_pos.left),o=Math.abs(t.top-s.mouse_init_pos.top);return r>s.options.distance||o>s.options.distance?e?(e=!1,s.on_dragstart.call(s,i),!1):(s.is_dragging===!0&&s.on_dragmove.call(s,i),!1):!1}),o?void 0:!1}},_.on_dragstart=function(t){if(t.preventDefault(),this.is_dragging)return this;this.drag_start=this.is_dragging=!0;var s=this.$container.offset();return this.baseX=Math.round(s.left),this.baseY=Math.round(s.top),this.initial_container_width=this.options.container_width||this.$container.width(),"clone"===this.options.helper?(this.$helper=this.$player.clone().appendTo(this.$container).addClass("helper"),this.helper=!0):this.helper=!1,this.win_offset_y=i(window).scrollTop(),this.win_offset_x=i(window).scrollLeft(),this.scroll_offset_y=0,this.scroll_offset_x=0,this.el_init_offset=this.$player.offset(),this.player_width=this.$player.width(),this.player_height=this.$player.height(),this.set_limits(this.options.container_width),this.options.start&&this.options.start.call(this.$player,t,this.get_drag_data(t)),!1},_.on_dragmove=function(i){var t=this.get_drag_data(i);this.options.autoscroll&&this.manage_scroll(t),this.options.move_element&&(this.helper?this.$helper:this.$player).css({position:"absolute",left:t.position.left,top:t.position.top});var s=this.last_position||t.position;return t.prev_position=s,this.options.drag&&this.options.drag.call(this.$player,i,t),this.last_position=t.position,!1},_.on_dragstop=function(i){var t=this.get_drag_data(i);return this.drag_start=!1,this.options.stop&&this.options.stop.call(this.$player,i,t),this.helper&&this.options.remove_helper&&this.$helper.remove(),!1},_.on_select_start=function(i){return this.disabled||this.ignore_drag(i)?void 0:!1},_.enable=function(){this.disabled=!1},_.disable=function(){this.disabled=!0},_.destroy=function(){this.disable(),this.$container.off(this.ns),this.$document.off(this.ns),i(window).off(this.ns),i.removeData(this.$container,"drag")},_.ignore_drag=function(t){return this.options.handle?!i(t.target).is(this.options.handle):i.isFunction(this.options.ignore_dragging)?this.options.ignore_dragging(t):i(t.target).is(this.options.ignore_dragging.join(", "))},i.fn.drag=function(i){return new t(this,i)},t}),function(i,t){"function"==typeof define&&define.amd?define(["jquery","gridster-draggable","gridster-collision"],t):i.Gridster=t(i.$||i.jQuery,i.GridsterDraggable,i.GridsterCollision)}(this,function(i,t,s){function e(t,s){this.options=i.extend(!0,{},r,s),this.$el=i(t),this.$wrapper=this.$el.parent(),this.$widgets=this.$el.children(this.options.widget_selector).addClass("gs-w"),this.widgets=[],this.$changed=i([]),this.wrapper_width=this.$wrapper.width(),this.min_widget_width=2*this.options.widget_margins[0]+this.options.widget_base_dimensions[0],this.min_widget_height=2*this.options.widget_margins[1]+this.options.widget_base_dimensions[1],this.generated_stylesheets=[],this.$style_tags=i([]),this.options.auto_init&&this.init()}var r={namespace:"",widget_selector:"li",widget_margins:[10,10],widget_base_dimensions:[400,225],extra_rows:0,extra_cols:0,min_cols:1,max_cols:1/0,min_rows:15,max_size_x:!1,autogrow_cols:!1,autogenerate_stylesheet:!0,avoid_overlapped_widgets:!0,auto_init:!0,serialize_params:function(i,t){return{col:t.col,row:t.row,size_x:t.size_x,size_y:t.size_y}},collision:{},draggable:{items:".gs-w",distance:4,ignore_dragging:t.defaults.ignore_dragging.slice(0)},resize:{enabled:!1,axes:["both"],handle_append_to:"",handle_class:"gs-resize-handle",max_size:[1/0,1/0],min_size:[1,1]}};e.defaults=r,e.generated_stylesheets=[],e.sort_by_row_asc=function(t){return t=t.sort(function(t,s){return t.row||(t=i(t).coords().grid,s=i(s).coords().grid),t.row>s.row?1:-1})},e.sort_by_row_and_col_asc=function(i){return i=i.sort(function(i,t){return i.row>t.row||i.row===t.row&&i.col>t.col?1:-1})},e.sort_by_col_asc=function(i){return i=i.sort(function(i,t){return i.col>t.col?1:-1})},e.sort_by_row_desc=function(i){return i=i.sort(function(i,t){return i.row+i.size_y<t.row+t.size_y?1:-1})};var o=e.prototype;return o.init=function(){this.options.resize.enabled&&this.setup_resize(),this.generate_grid_and_stylesheet(),this.get_widgets_from_DOM(),this.set_dom_grid_height(),this.set_dom_grid_width(),this.$wrapper.addClass("ready"),this.draggable(),this.options.resize.enabled&&this.resizable(),i(window).bind("resize.gridster",throttle(i.proxy(this.recalculate_faux_grid,this),200))},o.disable=function(){return this.$wrapper.find(".player-revert").removeClass("player-revert"),this.drag_api.disable(),this},o.enable=function(){return this.drag_api.enable(),this},o.disable_resize=function(){return this.$el.addClass("gs-resize-disabled"),this.resize_api.disable(),this},o.enable_resize=function(){return this.$el.removeClass("gs-resize-disabled"),this.resize_api.enable(),this},o.add_widget=function(t,s,e,r,o,a,n){var h;s||(s=1),e||(e=1),!r&!o?h=this.next_position(s,e):(h={col:r,row:o,size_x:s,size_y:e},this.empty_cells(r,o,s,e));var _=i(t).attr({"data-col":h.col,"data-row":h.row,"data-sizex":s,"data-sizey":e}).addClass("gs-w").appendTo(this.$el).hide();return this.$widgets=this.$widgets.add(_),this.register_widget(_),this.add_faux_rows(h.size_y),a&&this.set_widget_max_size(_,a),n&&this.set_widget_min_size(_,n),this.set_dom_grid_width(),this.set_dom_grid_height(),this.drag_api.set_limits(this.cols*this.min_widget_width),_.fadeIn()},o.set_widget_min_size=function(i,t){if(i="number"==typeof i?this.$widgets.eq(i):i,!i.length)return this;var s=i.data("coords").grid;return s.min_size_x=t[0],s.min_size_y=t[1],this},o.set_widget_max_size=function(i,t){if(i="number"==typeof i?this.$widgets.eq(i):i,!i.length)return this;var s=i.data("coords").grid;return s.max_size_x=t[0],s.max_size_y=t[1],this},o.add_resize_handle=function(t){var s=this.options.resize.handle_append_to;return i(this.resize_handle_tpl).appendTo(s?i(s,t):t),this},o.resize_widget=function(i,t,s,e){var r=i.coords().grid,o=r.col,a=this.options.max_cols,n=r.size_y,h=r.col,_=h;t||(t=r.size_x),s||(s=r.size_y),a!==1/0&&(t=Math.min(t,a-o+1)),s>n&&this.add_faux_rows(Math.max(s-n,0));var d=o+t-1;d>this.cols&&this.add_faux_cols(d-this.cols);var l={col:_,row:r.row,size_x:t,size_y:s};return this.mutate_widget_in_gridmap(i,r,l),this.set_dom_grid_height(),this.set_dom_grid_width(),e&&e.call(this,l.size_x,l.size_y),i},o.mutate_widget_in_gridmap=function(t,s,e){var r=(s.size_x,s.size_y),o=this.get_cells_occupied(s),a=this.get_cells_occupied(e),n=[];i.each(o.cols,function(t,s){-1===i.inArray(s,a.cols)&&n.push(s)});var h=[];i.each(a.cols,function(t,s){-1===i.inArray(s,o.cols)&&h.push(s)});var _=[];i.each(o.rows,function(t,s){-1===i.inArray(s,a.rows)&&_.push(s)});var d=[];if(i.each(a.rows,function(t,s){-1===i.inArray(s,o.rows)&&d.push(s)}),this.remove_from_gridmap(s),h.length){var l=[e.col,e.row,e.size_x,Math.min(r,e.size_y),t];this.empty_cells.apply(this,l)}if(d.length){var c=[e.col,e.row,e.size_x,e.size_y,t];this.empty_cells.apply(this,c)}if(s.col=e.col,s.row=e.row,s.size_x=e.size_x,s.size_y=e.size_y,this.add_to_gridmap(e,t),t.removeClass("player-revert"),t.data("coords").update({width:e.size_x*this.options.widget_base_dimensions[0]+(e.size_x-1)*this.options.widget_margins[0]*2,height:e.size_y*this.options.widget_base_dimensions[1]+(e.size_y-1)*this.options.widget_margins[1]*2}),t.attr({"data-col":e.col,"data-row":e.row,"data-sizex":e.size_x,"data-sizey":e.size_y}),n.length){var p=[n[0],e.row,n.length,Math.min(r,e.size_y),t];this.remove_empty_cells.apply(this,p)}if(_.length){var g=[e.col,e.row,e.size_x,e.size_y,t];this.remove_empty_cells.apply(this,g)}return this.move_widget_up(t),this},o.empty_cells=function(t,s,e,r,o){var a=this.widgets_below({col:t,row:s-r,size_x:e,size_y:r});return a.not(o).each(i.proxy(function(t,e){var o=i(e).coords().grid;if(o.row<=s+r-1){var a=s+r-o.row;this.move_widget_down(i(e),a)}},this)),this.set_dom_grid_height(),this},o.remove_empty_cells=function(t,s,e,r,o){var a=this.widgets_below({col:t,row:s,size_x:e,size_y:r});return a.not(o).each(i.proxy(function(t,s){this.move_widget_up(i(s),r)},this)),this.set_dom_grid_height(),this},o.next_position=function(i,t){i||(i=1),t||(t=1);for(var s,r=this.gridmap,o=r.length,a=[],n=1;o>n;n++){s=r[n].length;for(var h=1;s>=h;h++){var _=this.can_move_to({size_x:i,size_y:t},n,h);_&&a.push({col:n,row:h,size_y:t,size_x:i})}}return a.length?e.sort_by_row_and_col_asc(a)[0]:!1},o.remove_widget=function(t,s,e){var r=t instanceof i?t:i(t),o=r.coords().grid;i.isFunction(s)&&(e=s,s=!1),this.cells_occupied_by_placeholder={},this.$widgets=this.$widgets.not(r);var a=this.widgets_below(r);return this.remove_from_gridmap(o),r.fadeOut(i.proxy(function(){r.remove(),s||a.each(i.proxy(function(t,s){this.move_widget_up(i(s),o.size_y)},this)),this.set_dom_grid_height(),e&&e.call(this,t)},this)),this},o.remove_all_widgets=function(t){return this.$widgets.each(i.proxy(function(i,s){this.remove_widget(s,!0,t)},this)),this},o.serialize=function(t){return t||(t=this.$widgets),t.map(i.proxy(function(t,s){var e=i(s);return this.options.serialize_params(e,e.coords().grid)},this)).get()},o.serialize_changed=function(){return this.serialize(this.$changed)},o.dom_to_coords=function(i){return{col:parseInt(i.attr("data-col"),10),row:parseInt(i.attr("data-row"),10),size_x:parseInt(i.attr("data-sizex"),10)||1,size_y:parseInt(i.attr("data-sizey"),10)||1,max_size_x:parseInt(i.attr("data-max-sizex"),10)||!1,max_size_y:parseInt(i.attr("data-max-sizey"),10)||!1,min_size_x:parseInt(i.attr("data-min-sizex"),10)||!1,min_size_y:parseInt(i.attr("data-min-sizey"),10)||!1,el:i}},o.register_widget=function(t){var s=t instanceof jQuery,e=s?this.dom_to_coords(t):t,r=!1;s||(t=e.el);var o=this.can_go_widget_up(e);return o&&(e.row=o,t.attr("data-row",o),this.$el.trigger("gridster:positionchanged",[e]),r=!0),this.options.avoid_overlapped_widgets&&!this.can_move_to({size_x:e.size_x,size_y:e.size_y},e.col,e.row)&&(i.extend(e,this.next_position(e.size_x,e.size_y)),t.attr({"data-col":e.col,"data-row":e.row,"data-sizex":e.size_x,"data-sizey":e.size_y}),r=!0),t.data("coords",t.coords()),t.data("coords").grid=e,this.add_to_gridmap(e,t),this.options.resize.enabled&&this.add_resize_handle(t),r},o.update_widget_position=function(i,t){return this.for_each_cell_occupied(i,function(i,s){return this.gridmap[i]?void(this.gridmap[i][s]=t):this}),this},o.remove_from_gridmap=function(i){return this.update_widget_position(i,!1)},o.add_to_gridmap=function(t,s){if(this.update_widget_position(t,s||t.el),t.el){var e=this.widgets_below(t.el);e.each(i.proxy(function(t,s){this.move_widget_up(i(s))},this))}},o.draggable=function(){var t=this,s=i.extend(!0,{},this.options.draggable,{offset_left:this.options.widget_margins[0],offset_top:this.options.widget_margins[1],container_width:this.cols*this.min_widget_width,limit:!0,start:function(s,e){t.$widgets.filter(".player-revert").removeClass("player-revert"),t.$player=i(this),t.$helper=i(e.$helper),t.helper=!t.$helper.is(t.$player),t.on_start_drag.call(t,s,e),t.$el.trigger("gridster:dragstart")},stop:function(i,s){t.on_stop_drag.call(t,i,s),t.$el.trigger("gridster:dragstop")},drag:throttle(function(i,s){t.on_drag.call(t,i,s),t.$el.trigger("gridster:drag")},60)});return this.drag_api=this.$el.drag(s),this},o.resizable=function(){return this.resize_api=this.$el.drag({items:"."+this.options.resize.handle_class,offset_left:this.options.widget_margins[0],container_width:this.container_width,move_element:!1,resize:!0,limit:this.options.autogrow_cols?!1:!0,start:i.proxy(this.on_start_resize,this),stop:i.proxy(function(t,s){delay(i.proxy(function(){this.on_stop_resize(t,s)},this),120)},this),drag:throttle(i.proxy(this.on_resize,this),60)}),this},o.setup_resize=function(){this.resize_handle_class=this.options.resize.handle_class;var t=this.options.resize.axes,s='<span class="'+this.resize_handle_class+" "+this.resize_handle_class+'-{type}" />';return this.resize_handle_tpl=i.map(t,function(i){return s.replace("{type}",i)}).join(""),i.isArray(this.options.draggable.ignore_dragging)&&this.options.draggable.ignore_dragging.push("."+this.resize_handle_class),this},o.on_start_drag=function(t,s){this.$helper.add(this.$player).add(this.$wrapper).addClass("dragging"),this.highest_col=this.get_highest_occupied_cell().col,this.$player.addClass("player"),this.player_grid_data=this.$player.coords().grid,this.placeholder_grid_data=i.extend({},this.player_grid_data),this.set_dom_grid_height(this.$el.height()+this.player_grid_data.size_y*this.min_widget_height),this.set_dom_grid_width(this.cols);var e=this.player_grid_data.size_x,r=this.cols-this.highest_col;this.options.autogrow_cols&&e>=r&&this.add_faux_cols(Math.min(e-r,1));var o=this.faux_grid,a=this.$player.data("coords").coords;this.cells_occupied_by_player=this.get_cells_occupied(this.player_grid_data),this.cells_occupied_by_placeholder=this.get_cells_occupied(this.placeholder_grid_data),this.last_cols=[],this.last_rows=[],this.collision_api=this.$helper.collision(o,this.options.collision),this.$preview_holder=i("<"+this.$player.get(0).tagName+" />",{"class":"preview-holder","data-row":this.$player.attr("data-row"),"data-col":this.$player.attr("data-col"),css:{width:a.width,height:a.height}}).appendTo(this.$el),this.options.draggable.start&&this.options.draggable.start.call(this,t,s)},o.on_drag=function(i,t){if(null===this.$player)return!1;var s={left:t.position.left+this.baseX,top:t.position.top+this.baseY};if(this.options.autogrow_cols){var e=this.placeholder_grid_data.col+this.placeholder_grid_data.size_x-1;e>=this.cols-1&&this.options.max_cols>=this.cols+1&&(this.add_faux_cols(1),this.set_dom_grid_width(this.cols+1),this.drag_api.set_limits(this.container_width)),this.collision_api.set_colliders(this.faux_grid)}this.colliders_data=this.collision_api.get_closest_colliders(s),this.on_overlapped_column_change(this.on_start_overlapping_column,this.on_stop_overlapping_column),this.on_overlapped_row_change(this.on_start_overlapping_row,this.on_stop_overlapping_row),this.helper&&this.$player&&this.$player.css({left:t.position.left,top:t.position.top}),this.options.draggable.drag&&this.options.draggable.drag.call(this,i,t)},o.on_stop_drag=function(i,t){this.$helper.add(this.$player).add(this.$wrapper).removeClass("dragging"),t.position.left=t.position.left+this.baseX,t.position.top=t.position.top+this.baseY,this.colliders_data=this.collision_api.get_closest_colliders(t.position),this.on_overlapped_column_change(this.on_start_overlapping_column,this.on_stop_overlapping_column),this.on_overlapped_row_change(this.on_start_overlapping_row,this.on_stop_overlapping_row),this.$player.addClass("player-revert").removeClass("player").attr({"data-col":this.placeholder_grid_data.col,"data-row":this.placeholder_grid_data.row}).css({left:"",top:""}),this.$changed=this.$changed.add(this.$player),this.cells_occupied_by_player=this.get_cells_occupied(this.placeholder_grid_data),this.set_cells_player_occupies(this.placeholder_grid_data.col,this.placeholder_grid_data.row),this.$player.coords().grid.row=this.placeholder_grid_data.row,this.$player.coords().grid.col=this.placeholder_grid_data.col,this.options.draggable.stop&&this.options.draggable.stop.call(this,i,t),this.$preview_holder.remove(),this.$player=null,this.$helper=null,this.placeholder_grid_data={},this.player_grid_data={},this.cells_occupied_by_placeholder={},this.cells_occupied_by_player={},this.set_dom_grid_height(),this.set_dom_grid_width(),this.options.autogrow_cols&&this.drag_api.set_limits(this.cols*this.min_widget_width)},o.on_start_resize=function(t,s){this.$resized_widget=s.$player.closest(".gs-w"),this.resize_coords=this.$resized_widget.coords(),this.resize_wgd=this.resize_coords.grid,this.resize_initial_width=this.resize_coords.coords.width,this.resize_initial_height=this.resize_coords.coords.height,this.resize_initial_sizex=this.resize_coords.grid.size_x,this.resize_initial_sizey=this.resize_coords.grid.size_y,this.resize_initial_col=this.resize_coords.grid.col,this.resize_last_sizex=this.resize_initial_sizex,this.resize_last_sizey=this.resize_initial_sizey,this.resize_max_size_x=Math.min(this.resize_wgd.max_size_x||this.options.resize.max_size[0],this.options.max_cols-this.resize_initial_col+1),this.resize_max_size_y=this.resize_wgd.max_size_y||this.options.resize.max_size[1],this.resize_min_size_x=this.resize_wgd.min_size_x||this.options.resize.min_size[0]||1,this.resize_min_size_y=this.resize_wgd.min_size_y||this.options.resize.min_size[1]||1,this.resize_initial_last_col=this.get_highest_occupied_cell().col,this.set_dom_grid_width(this.cols),this.resize_dir={right:s.$player.is("."+this.resize_handle_class+"-x"),bottom:s.$player.is("."+this.resize_handle_class+"-y")},this.$resized_widget.css({"min-width":this.options.widget_base_dimensions[0],"min-height":this.options.widget_base_dimensions[1]});var e=this.$resized_widget.get(0).tagName;this.$resize_preview_holder=i("<"+e+" />",{"class":"preview-holder resize-preview-holder","data-row":this.$resized_widget.attr("data-row"),"data-col":this.$resized_widget.attr("data-col"),css:{width:this.resize_initial_width,height:this.resize_initial_height}}).appendTo(this.$el),this.$resized_widget.addClass("resizing"),this.options.resize.start&&this.options.resize.start.call(this,t,s,this.$resized_widget),this.$el.trigger("gridster:resizestart")},o.on_stop_resize=function(t,s){this.$resized_widget.removeClass("resizing").css({width:"",height:""}),delay(i.proxy(function(){this.$resize_preview_holder.remove().css({"min-width":"","min-height":""}),this.options.resize.stop&&this.options.resize.stop.call(this,t,s,this.$resized_widget),this.$el.trigger("gridster:resizestop")},this),300),this.set_dom_grid_width(),this.options.autogrow_cols&&this.drag_api.set_limits(this.cols*this.min_widget_width)},o.on_resize=function(i,t){var s,e=t.pointer.diff_left,r=t.pointer.diff_top,o=this.options.widget_base_dimensions[0],a=this.options.widget_base_dimensions[1],n=this.options.widget_margins[0],h=this.options.widget_margins[1],_=this.resize_max_size_x,d=this.resize_min_size_x,l=this.resize_max_size_y,c=this.resize_min_size_y,p=this.options.autogrow_cols,g=1/0,u=1/0,f=Math.ceil(e/(o+2*n)-.2),w=Math.ceil(r/(a+2*h)-.2),m=Math.max(1,this.resize_initial_sizex+f),y=Math.max(1,this.resize_initial_sizey+w),v=this.container_width/this.min_widget_width-this.resize_initial_col+1,z=v*this.min_widget_width-2*n;if(m=Math.max(Math.min(m,_),d),m=Math.min(v,m),s=_*o+(m-1)*n*2,g=Math.min(s,z),min_width=d*o+(m-1)*n*2,y=Math.max(Math.min(y,l),c),u=l*a+(y-1)*h*2,min_height=c*a+(y-1)*h*2,this.resize_dir.right?y=this.resize_initial_sizey:this.resize_dir.bottom&&(m=this.resize_initial_sizex),p){var x=this.resize_initial_col+m-1;p&&this.resize_initial_last_col<=x&&(this.set_dom_grid_width(Math.max(x+1,this.cols)),this.cols<x&&this.add_faux_cols(x-this.cols))}var $={};!this.resize_dir.bottom&&($.width=Math.max(Math.min(this.resize_initial_width+e,g),min_width)),!this.resize_dir.right&&($.height=Math.max(Math.min(this.resize_initial_height+r,u),min_height)),this.$resized_widget.css($),(m!==this.resize_last_sizex||y!==this.resize_last_sizey)&&(this.resize_widget(this.$resized_widget,m,y),this.set_dom_grid_width(this.cols),this.$resize_preview_holder.css({width:"",height:""}).attr({"data-row":this.$resized_widget.attr("data-row"),"data-sizex":m,"data-sizey":y})),this.options.resize.resize&&this.options.resize.resize.call(this,i,t,this.$resized_widget),this.$el.trigger("gridster:resize"),this.resize_last_sizex=m,this.resize_last_sizey=y},o.on_overlapped_column_change=function(t,s){if(!this.colliders_data.length)return this;var e,r=this.get_targeted_columns(this.colliders_data[0].el.data.col),o=this.last_cols.length,a=r.length;for(e=0;a>e;e++)-1===i.inArray(r[e],this.last_cols)&&(t||i.noop).call(this,r[e]);for(e=0;o>e;e++)-1===i.inArray(this.last_cols[e],r)&&(s||i.noop).call(this,this.last_cols[e]);return this.last_cols=r,this},o.on_overlapped_row_change=function(t,s){if(!this.colliders_data.length)return this;var e,r=this.get_targeted_rows(this.colliders_data[0].el.data.row),o=this.last_rows.length,a=r.length;for(e=0;a>e;e++)-1===i.inArray(r[e],this.last_rows)&&(t||i.noop).call(this,r[e]);for(e=0;o>e;e++)-1===i.inArray(this.last_rows[e],r)&&(s||i.noop).call(this,this.last_rows[e]);this.last_rows=r},o.set_player=function(i,t,s){var e=this;s||this.empty_cells_player_occupies();var r=s?{col:i}:e.colliders_data[0].el.data,o=r.col,a=t||r.row;this.player_grid_data={col:o,row:a,size_y:this.player_grid_data.size_y,size_x:this.player_grid_data.size_x},this.cells_occupied_by_player=this.get_cells_occupied(this.player_grid_data);var n=this.get_widgets_overlapped(this.player_grid_data),h=this.widgets_constraints(n);if(this.manage_movements(h.can_go_up,o,a),this.manage_movements(h.can_not_go_up,o,a),!n.length){var _=this.can_go_player_up(this.player_grid_data);_!==!1&&(a=_),this.set_placeholder(o,a)}return{col:o,row:a}},o.widgets_constraints=function(t){var s,r=i([]),o=[],a=[];return t.each(i.proxy(function(t,s){var e=i(s),n=e.coords().grid;this.can_go_widget_up(n)?(r=r.add(e),o.push(n)):a.push(n)},this)),s=t.not(r),{can_go_up:e.sort_by_row_asc(o),can_not_go_up:e.sort_by_row_desc(a)}},o.manage_movements=function(t,s,e){return i.each(t,i.proxy(function(i,t){var r=t,o=r.el,a=this.can_go_widget_up(r);if(a)this.move_widget_to(o,a),this.set_placeholder(s,a+r.size_y);else{var n=this.can_go_player_up(this.player_grid_data);if(!n){var h=e+this.player_grid_data.size_y-r.row;this.move_widget_down(o,h),this.set_placeholder(s,e)}}},this)),this},o.is_player=function(i,t){if(t&&!this.gridmap[i])return!1;var s=t?this.gridmap[i][t]:i;return s&&(s.is(this.$player)||s.is(this.$helper))},o.is_player_in=function(t,s){var e=this.cells_occupied_by_player||{};return i.inArray(t,e.cols)>=0&&i.inArray(s,e.rows)>=0},o.is_placeholder_in=function(t,s){var e=this.cells_occupied_by_placeholder||{};return this.is_placeholder_in_col(t)&&i.inArray(s,e.rows)>=0},o.is_placeholder_in_col=function(t){var s=this.cells_occupied_by_placeholder||[];return i.inArray(t,s.cols)>=0},o.is_empty=function(i,t){return"undefined"!=typeof this.gridmap[i]?"undefined"!=typeof this.gridmap[i][t]&&this.gridmap[i][t]===!1?!0:!1:!0},o.is_occupied=function(i,t){return this.gridmap[i]&&this.gridmap[i][t]?!0:!1},o.is_widget=function(i,t){var s=this.gridmap[i];return s?(s=s[t],s?s:!1):!1},o.is_widget_under_player=function(i,t){return this.is_widget(i,t)?this.is_player_in(i,t):!1},o.get_widgets_under_player=function(t){t||(t=this.cells_occupied_by_player||{cols:[],rows:[]});var s=i([]);return i.each(t.cols,i.proxy(function(e,r){i.each(t.rows,i.proxy(function(i,t){this.is_widget(r,t)&&(s=s.add(this.gridmap[r][t]))},this))},this)),s},o.set_placeholder=function(t,s){var e=i.extend({},this.placeholder_grid_data),r=this.widgets_below({col:e.col,row:e.row,size_y:e.size_y,size_x:e.size_x}),o=t+e.size_x-1;o>this.cols&&(t-=o-t);var a=this.placeholder_grid_data.row<s,n=this.placeholder_grid_data.col!==t;this.placeholder_grid_data.col=t,this.placeholder_grid_data.row=s,this.cells_occupied_by_placeholder=this.get_cells_occupied(this.placeholder_grid_data),this.$preview_holder.attr({"data-row":s,"data-col":t}),(a||n)&&r.each(i.proxy(function(s,r){this.move_widget_up(i(r),this.placeholder_grid_data.col-t+e.size_y)},this));var h=this.get_widgets_under_player(this.cells_occupied_by_placeholder);h.length&&h.each(i.proxy(function(t,r){var o=i(r);this.move_widget_down(o,s+e.size_y-o.data("coords").grid.row)},this))},o.can_go_player_up=function(i){var t=i.row+i.size_y-1,s=!0,e=[],r=1e4,o=this.get_widgets_under_player();return this.for_each_column_occupied(i,function(i){var a=this.gridmap[i],n=t+1;for(e[i]=[];--n>0&&(this.is_empty(i,n)||this.is_player(i,n)||this.is_widget(i,n)&&a[n].is(o));)e[i].push(n),r=r>n?n:r;
return 0===e[i].length?(s=!1,!0):void e[i].sort(function(i,t){return i-t})}),s?this.get_valid_rows(i,e,r):!1},o.can_go_widget_up=function(i){var t=i.row+i.size_y-1,s=!0,e=[],r=1e4;return this.for_each_column_occupied(i,function(o){var a=this.gridmap[o];e[o]=[];for(var n=t+1;--n>0&&(!this.is_widget(o,n)||this.is_player_in(o,n)||a[n].is(i.el));)this.is_player(o,n)||this.is_placeholder_in(o,n)||this.is_player_in(o,n)||e[o].push(n),r>n&&(r=n);return 0===e[o].length?(s=!1,!0):void e[o].sort(function(i,t){return i-t})}),s?this.get_valid_rows(i,e,r):!1},o.get_valid_rows=function(t,s,e){for(var r=t.row,o=t.row+t.size_y-1,a=t.size_y,n=e-1,h=[];++n<=o;){var _=!0;if(i.each(s,function(t,s){i.isArray(s)&&-1===i.inArray(n,s)&&(_=!1)}),_===!0&&(h.push(n),h.length===a))break}var d=!1;return 1===a?h[0]!==r&&(d=h[0]||!1):h[0]!==r&&(d=this.get_consecutive_numbers_index(h,a)),d},o.get_consecutive_numbers_index=function(i,t){for(var s=i.length,e=[],r=!0,o=-1,a=0;s>a;a++){if(r||i[a]===o+1){if(e.push(a),e.length===t)break;r=!1}else e=[],r=!0;o=i[a]}return e.length>=t?i[e[0]]:!1},o.get_widgets_overlapped=function(){var t=i([]),s=[],e=this.cells_occupied_by_player.rows.slice(0);return e.reverse(),i.each(this.cells_occupied_by_player.cols,i.proxy(function(r,o){i.each(e,i.proxy(function(e,r){if(!this.gridmap[o])return!0;var a=this.gridmap[o][r];this.is_occupied(o,r)&&!this.is_player(a)&&-1===i.inArray(a,s)&&(t=t.add(a),s.push(a))},this))},this)),t},o.on_start_overlapping_column=function(i){this.set_player(i,!1)},o.on_start_overlapping_row=function(i){this.set_player(!1,i)},o.on_stop_overlapping_column=function(i){this.set_player(i,!1);var t=this;this.for_each_widget_below(i,this.cells_occupied_by_player.rows[0],function(i,s){t.move_widget_up(this,t.player_grid_data.size_y)})},o.on_stop_overlapping_row=function(i){this.set_player(!1,i);for(var t=this,s=this.cells_occupied_by_player.cols,e=0,r=s.length;r>e;e++)this.for_each_widget_below(s[e],i,function(i,s){t.move_widget_up(this,t.player_grid_data.size_y)})},o.move_widget_to=function(t,s){var e=this,r=t.coords().grid,o=(s-r.row,this.widgets_below(t)),a=this.can_move_to(r,r.col,s,t);return a===!1?!1:(this.remove_from_gridmap(r),r.row=s,this.add_to_gridmap(r),t.attr("data-row",s),this.$changed=this.$changed.add(t),o.each(function(t,s){var r=i(s),o=r.coords().grid,a=e.can_go_widget_up(o);a&&a!==o.row&&e.move_widget_to(r,a)}),this)},o.move_widget_up=function(t,s){var e=t.coords().grid;if(e){var r=e.row,o=[];return s||(s=1),this.can_go_up(t)?void this.for_each_column_occupied(e,function(e){if(-1===i.inArray(t,o)){var a=t.coords().grid,n=r-s;if(n=this.can_go_up_to_row(a,e,n),!n)return!0;var h=this.widgets_below(t);this.remove_from_gridmap(a),a.row=n,this.add_to_gridmap(a),t.attr("data-row",a.row),this.$changed=this.$changed.add(t),o.push(t),h.each(i.proxy(function(t,e){this.move_widget_up(i(e),s)},this))}}):!1}},o.move_widget_down=function(t,s){var e,r,o,a;if(!s||0>=s)return!1;if(e=t.coords().grid,r=e.row,o=[],a=s,!t)return!1;if(-1===i.inArray(t,o)){var n=t.coords().grid,h=r+s,_=this.widgets_below(t);this.remove_from_gridmap(n),_.each(i.proxy(function(t,s){var e=i(s),r=e.coords().grid,o=this.displacement_diff(r,n,a);o>0&&this.move_widget_down(e,o)},this)),n.row=h,this.update_widget_position(n,t),t.attr("data-row",n.row),this.$changed=this.$changed.add(t),o.push(t)}},o.can_go_up_to_row=function(t,s,e){var r,o=this.gridmap,a=!0,n=[],h=t.row;if(this.for_each_column_occupied(t,function(i){o[i];for(n[i]=[],r=h;r--&&this.is_empty(i,r)&&!this.is_placeholder_in(i,r);)n[i].push(r);return n[i].length?void 0:(a=!1,!0)}),!a)return!1;for(r=e,r=1;h>r;r++){for(var _=!0,d=0,l=n.length;l>d;d++)n[d]&&-1===i.inArray(r,n[d])&&(_=!1);if(_===!0){a=r;break}}return a},o.displacement_diff=function(i,t,s){var e=i.row,r=[],o=t.row+t.size_y;this.for_each_column_occupied(i,function(i){for(var t=0,s=o;e>s;s++)this.is_empty(i,s)&&(t+=1);r.push(t)});var a=Math.max.apply(Math,r);return s-=a,s>0?s:0},o.widgets_below=function(t){var s=i.isPlainObject(t)?t:t.coords().grid,r=this,o=(this.gridmap,s.row+s.size_y-1),a=i([]);return this.for_each_column_occupied(s,function(t){r.for_each_widget_below(t,o,function(t,s){return r.is_player(this)||-1!==i.inArray(this,a)?void 0:(a=a.add(this),!0)})}),e.sort_by_row_asc(a)},o.set_cells_player_occupies=function(i,t){return this.remove_from_gridmap(this.placeholder_grid_data),this.placeholder_grid_data.col=i,this.placeholder_grid_data.row=t,this.add_to_gridmap(this.placeholder_grid_data,this.$player),this},o.empty_cells_player_occupies=function(){return this.remove_from_gridmap(this.placeholder_grid_data),this},o.can_go_up=function(i){var t=i.coords().grid,s=t.row,e=s-1,r=(this.gridmap,!0);return 1===s?!1:(this.for_each_column_occupied(t,function(i){this.is_widget(i,e);return this.is_occupied(i,e)||this.is_player(i,e)||this.is_placeholder_in(i,e)||this.is_player_in(i,e)?(r=!1,!0):void 0}),r)},o.can_move_to=function(i,t,s,e){var r=(this.gridmap,i.el),o={size_y:i.size_y,size_x:i.size_x,col:t,row:s},a=!0,n=t+i.size_x-1;return n>this.cols?!1:e&&e<s+i.size_y-1?!1:(this.for_each_cell_occupied(o,function(t,s){var e=this.is_widget(t,s);!e||i.el&&!e.is(r)||(a=!1)}),a)},o.get_targeted_columns=function(i){for(var t=(i||this.player_grid_data.col)+(this.player_grid_data.size_x-1),s=[],e=i;t>=e;e++)s.push(e);return s},o.get_targeted_rows=function(i){for(var t=(i||this.player_grid_data.row)+(this.player_grid_data.size_y-1),s=[],e=i;t>=e;e++)s.push(e);return s},o.get_cells_occupied=function(t){var s,e={cols:[],rows:[]};for(arguments[1]instanceof i&&(t=arguments[1].coords().grid),s=0;s<t.size_x;s++){var r=t.col+s;e.cols.push(r)}for(s=0;s<t.size_y;s++){var o=t.row+s;e.rows.push(o)}return e},o.for_each_cell_occupied=function(i,t){return this.for_each_column_occupied(i,function(s){this.for_each_row_occupied(i,function(i){t.call(this,s,i)})}),this},o.for_each_column_occupied=function(i,t){for(var s=0;s<i.size_x;s++){var e=i.col+s;t.call(this,e,i)}},o.for_each_row_occupied=function(i,t){for(var s=0;s<i.size_y;s++){var e=i.row+s;t.call(this,e,i)}},o._traversing_widgets=function(t,s,e,r,o){var a=this.gridmap;if(a[e]){var n,h,_=t+"/"+s;if(arguments[2]instanceof i){var d=arguments[2].coords().grid;e=d.col,r=d.row,o=arguments[3]}var l=[],c=r,p={"for_each/above":function(){for(;c--&&!(c>0&&this.is_widget(e,c)&&-1===i.inArray(a[e][c],l)&&(n=o.call(a[e][c],e,c),l.push(a[e][c]),n)););},"for_each/below":function(){for(c=r+1,h=a[e].length;h>c&&(!this.is_widget(e,c)||-1!==i.inArray(a[e][c],l)||(n=o.call(a[e][c],e,c),l.push(a[e][c]),!n));c++);}};p[_]&&p[_].call(this)}},o.for_each_widget_above=function(i,t,s){return this._traversing_widgets("for_each","above",i,t,s),this},o.for_each_widget_below=function(i,t,s){return this._traversing_widgets("for_each","below",i,t,s),this},o.get_highest_occupied_cell=function(){for(var i,t=this.gridmap,s=t[1].length,e=[],r=[],o=t.length-1;o>=1;o--)for(i=s-1;i>=1;i--)if(this.is_widget(o,i)){e.push(i),r.push(o);break}return{col:Math.max.apply(Math,r),row:Math.max.apply(Math,e)}},o.get_widgets_from=function(t,s){var e=(this.gridmap,i());return t&&(e=e.add(this.$widgets.filter(function(){var s=i(this).attr("data-col");return s===t||s>t}))),s&&(e=e.add(this.$widgets.filter(function(){var t=i(this).attr("data-row");return t===s||t>s}))),e},o.set_dom_grid_height=function(i){if("undefined"==typeof i){var t=this.get_highest_occupied_cell().row;i=t*this.min_widget_height}return this.container_height=i,this.$el.css("height",this.container_height),this},o.set_dom_grid_width=function(i){"undefined"==typeof i&&(i=this.get_highest_occupied_cell().col);var t=this.options.autogrow_cols?this.options.max_cols:this.cols;return i=Math.min(t,Math.max(i,this.options.min_cols)),this.container_width=i*this.min_widget_width,this.$el.css("width",this.container_width),this},o.generate_stylesheet=function(t){var s,e="",r=this.options.max_size_x||this.cols;t||(t={}),t.cols||(t.cols=this.cols),t.rows||(t.rows=this.rows),t.namespace||(t.namespace=this.options.namespace),t.widget_base_dimensions||(t.widget_base_dimensions=this.options.widget_base_dimensions),t.widget_margins||(t.widget_margins=this.options.widget_margins),t.min_widget_width=2*t.widget_margins[0]+t.widget_base_dimensions[0],t.min_widget_height=2*t.widget_margins[1]+t.widget_base_dimensions[1];i.param(t);for(s=t.cols;s>=0;s--)e+=t.namespace+' [data-col="'+(s+1)+'"] { left:'+(s*t.widget_base_dimensions[0]+s*t.widget_margins[0]+(s+1)*t.widget_margins[0])+"px; }\n";for(s=t.rows;s>=0;s--)e+=t.namespace+' [data-row="'+(s+1)+'"] { top:'+(s*t.widget_base_dimensions[1]+s*t.widget_margins[1]+(s+1)*t.widget_margins[1])+"px; }\n";for(var o=1;o<=t.rows;o++)e+=t.namespace+' [data-sizey="'+o+'"] { height:'+(o*t.widget_base_dimensions[1]+2*(o-1)*t.widget_margins[1])+"px; }\n";for(var a=1;r>=a;a++)e+=t.namespace+' [data-sizex="'+a+'"] { width:'+(a*t.widget_base_dimensions[0]+2*(a-1)*t.widget_margins[0])+"px; }\n";return this.remove_style_tags(),this.add_style_tag(e)},o.add_style_tag=function(i){var t=document,s=t.createElement("style");return t.getElementsByTagName("head")[0].appendChild(s),s.setAttribute("type","text/css"),s.styleSheet?s.styleSheet.cssText=i:s.appendChild(document.createTextNode(i)),this.$style_tags=this.$style_tags.add(s),this},o.remove_style_tags=function(){this.$style_tags.remove()},o.generate_faux_grid=function(i,t){this.faux_grid=[],this.gridmap=[];var s,e;for(s=t;s>0;s--)for(this.gridmap[s]=[],e=i;e>0;e--)this.add_faux_cell(e,s);return this},o.add_faux_cell=function(t,s){var e=i({left:this.baseX+(s-1)*this.min_widget_width,top:this.baseY+(t-1)*this.min_widget_height,width:this.min_widget_width,height:this.min_widget_height,col:s,row:t,original_col:s,original_row:t}).coords();return i.isArray(this.gridmap[s])||(this.gridmap[s]=[]),this.gridmap[s][t]=!1,this.faux_grid.push(e),this},o.add_faux_rows=function(i){for(var t=this.rows,s=t+(i||1),e=s;e>t;e--)for(var r=this.cols;r>=1;r--)this.add_faux_cell(e,r);return this.rows=s,this.options.autogenerate_stylesheet&&this.generate_stylesheet(),this},o.add_faux_cols=function(i){var t=this.cols,s=t+(i||1);s=Math.min(s,this.options.max_cols);for(var e=t+1;s>=e;e++)for(var r=this.rows;r>=1;r--)this.add_faux_cell(r,e);return this.cols=s,this.options.autogenerate_stylesheet&&this.generate_stylesheet(),this},o.recalculate_faux_grid=function(){var t=this.$wrapper.width();return this.baseX=(i(window).width()-t)/2,this.baseY=this.$wrapper.offset().top,i.each(this.faux_grid,i.proxy(function(i,t){this.faux_grid[i]=t.update({left:this.baseX+(t.data.col-1)*this.min_widget_width,top:this.baseY+(t.data.row-1)*this.min_widget_height})},this)),this},o.get_widgets_from_DOM=function(){var t=this.$widgets.map(i.proxy(function(t,s){var e=i(s);return this.dom_to_coords(e)},this));t=e.sort_by_row_and_col_asc(t);var s=i(t).map(i.proxy(function(i,t){return this.register_widget(t)||null},this));return s.length&&this.$el.trigger("gridster:positionschanged"),this},o.generate_grid_and_stylesheet=function(){var t=this.$wrapper.width()-20,s=this.options.max_cols,e=Math.floor(t/this.min_widget_width)+this.options.extra_cols,r=this.$widgets.map(function(){return i(this).attr("data-col")}).get();r.length||(r=[0]);var o=Math.max.apply(Math,r);this.cols=Math.max(o,e,this.options.min_cols),s!==1/0&&s>=o&&s<this.cols&&(this.cols=s);var a=this.options.extra_rows;return this.$widgets.each(function(t,s){a+=+i(s).attr("data-sizey")}),this.rows=Math.max(a,this.options.min_rows),this.baseX=(i(window).width()-t)/2,this.baseY=this.$wrapper.offset().top,this.options.autogenerate_stylesheet&&this.generate_stylesheet(),this.generate_faux_grid(this.rows,this.cols)},o.destroy=function(t){return this.$el.removeData("gridster"),i(window).unbind(".gridster"),this.drag_api&&this.drag_api.destroy(),this.remove_style_tags(),t&&this.$el.remove(),this},o.resize_widget_dimensions=function(t,s){t.widget_margins&&(this.options.widget_margins=t.widget_margins),t.widget_base_dimensions&&(this.options.widget_base_dimensions=t.widget_base_dimensions),t.max_cols&&(this.options.max_cols=t.max_cols),this.min_widget_width=2*this.options.widget_margins[0]+this.options.widget_base_dimensions[0],this.min_widget_height=2*this.options.widget_margins[1]+this.options.widget_base_dimensions[1];this.serialize();return this.$widgets.each(i.proxy(function(t,s){var e=i(s);this.resize_widget(e)},this)),this.generate_grid_and_stylesheet(),this.get_widgets_from_DOM(),this.set_dom_grid_height(),this.drag_api.set_limits(this.cols*this.min_widget_width),this},i.fn.gridster=function(t){return this.each(function(){i(this).data("gridster")||i(this).data("gridster",new e(this,t))})},e});